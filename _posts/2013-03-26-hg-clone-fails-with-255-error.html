---
layout: post
title: hg clone fails with 255 error
categories:
- Software Development
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '2'
  _syntaxhighlighter_encoded: '1'
author:
  login: craig
  email: craigpardey@gmail.com
  display_name: craig
  first_name: Craig
  last_name: Pardey
---
<p>I recently encountered an issue with cloning a Mercurial repository where it would fail with an obtuse error stating that "<code>[command returned code 255 Mon Mar 25 11:39:55 2013]</code>".  My initial Googling implied that this was caused by a server timeout but the problem persisted even after increasing the timeout on our Apache web server.</p>
<p>The clone was always failing on one particular file - a 600Mb binary. (Don't ask...)</p>
<p>To get around the problem, I zipped up an existing clone of the repository and copied it to the target machine. The developer then tried to switch to the branch he needed to be on.</p>
<p>[code]<br />
hg update SomeBranchName<br />
abort: out of memory<br />
[/code]</p>
<p>Close, but no cigar. But maybe available memory on the workstation is the culprit here and not some obscure timeout setting on the web server.  There's a page on the Mercurial wiki that discusses how <a href="http://mercurial.selenic.com/wiki/HandlingLargeFiles">large files</a> are handled.  Poorly, as it turns out.</p>
<p>On my workstation, I repeated the steps the developer was taking and monitored the memory usage.  When it hit the offending 600Mb file the memory usage jumped to 1.2Gb for a split-second and then dropped back to 600Mb while it copied the file.</p>
<p>The developer's workstation only has 3Gb of RAM so he closed down all other running programs and tried to update again but it <i>still did not work</i>!</p>
<p>You can imagine how frustrating this was becoming, and by this point I've already lost the developer as a potential Mercurial convert.</p>
<p>As a last ditch effort, I removed the large file from the branch he was interested in, pushed the change and asked him to pull, then update to the appropriate branch.  It worked, but it was far from ideal.</p>
<p>The moral of this <del datetime="2013-03-26T14:24:51+00:00">story</del> rant is that Mercurial is not very good at handling large files, particularly on an underpowered workstation.  Even worse, there's no way easy way to remove a problematic file after it has been checked in - it'll always be in the history.</p>
