---
layout: post
title: JUnit categories with Maven
categories:
- Software Development
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '2'
  _aioseop_keywords: junit, maven, surefire, excludedgroups
  Title: JUnit categories with Maven
  _aioseop_description: ! 'Getting Maven''s SureFire plugin to work with your JUnit
    categories can be frustrating so here''s a few things that I learnt along the
    way. '
  _aioseop_title: JUnit categories with Maven
  Description: Getting Maven's SureFire plugin to work with your JUnit categories
    can be frustrating so here's a few things that I learnt along the way.
  Keywords: junit, maven, surefire, excludedgroups
  _syntaxhighlighter_encoded: '1'
author:
  login: craig
  email: craigpardey@gmail.com
  display_name: craig
  first_name: Craig
  last_name: Pardey
---
<p>Getting Maven's SureFire plugin to work with your JUnit categories can be frustrating so here's a few things that I learnt along the way.  The first point to note is that categories only work with surefire 2.11 or greater.</p>
<p>You also need to set up the surefire plugin correctly as follows:<br />
Create the interface that will be used to categorize your unit tests.<br />
[java]<br />
public interface SlowTest {}<br />
[/java]</p>
<p>Add the category to your test method (or class-level)<br />
[java]<br />
@Test<br />
@Category(SlowTest.class)<br />
public void excludedTestMethod() {<br />
	Example eg = new Example();<br />
	eg.methodTwo();<br />
}<br />
[/java]</p>
<p>Configure the maven-surefire-plugin.  The inline dependency is very important - Maven will ignore your @Category annotation otherwise.<br />
[xml]<br />
&lt;plugin&gt;<br />
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br />
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br />
    &lt;version&gt;2.12&lt;/version&gt;<br />
    &lt;dependencies&gt;<br />
        &lt;dependency&gt;<br />
            &lt;groupId&gt;org.apache.maven.surefire&lt;/groupId&gt;<br />
            &lt;artifactId&gt;surefire-junit47&lt;/artifactId&gt;<br />
            &lt;version&gt;2.12&lt;/version&gt;<br />
        &lt;/dependency&gt;<br />
    &lt;/dependencies&gt;<br />
    &lt;configuration&gt;<br />
        &lt;excludedGroups&gt;com.craigpardey.test.annotation.SlowTest&lt;/excludedGroups&gt;<br />
    &lt;/configuration&gt;<br />
&lt;/plugin&gt;<br />
[/xml]</p>
<p>If that works for you, then you're done.  </p>
<p>However, you may be seeing weird stacktraces in your build.</p>
<p>[plain language="text"]<br />
-------------------------------------------------------<br />
 T E S T S<br />
-------------------------------------------------------<br />
Concurrency config is parallel='none', perCoreThreadCount=true, threadCount=2, useUnlimitedThreads=false<br />
org.apache.maven.surefire.util.SurefireReflectionException: java.lang.reflect.InvocationTargetException; nested exception is java.lang.reflect.InvocationTargetException: null<br />
java.lang.reflect.InvocationTargetException<br />
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br />
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br />
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br />
        at java.lang.reflect.Method.invoke(Method.java:597)<br />
        at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)<br />
        at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)<br />
        at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)<br />
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:103)<br />
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:74)<br />
Caused by: java.lang.NoSuchMethodError: org.junit.runner.Description.getMethodName()Ljava/lang/String;<br />
        at org.apache.maven.surefire.common.junit48.FilterFactory$GroupMatcherCategoryFilter.shouldRun(FilterFactory.java:207)<br />
        at org.apache.maven.surefire.junitcore.JUnitCoreProvider.getSuitesAsList(JUnitCoreProvider.java:159)<br />
        at org.apache.maven.surefire.junitcore.JUnitCoreProvider.invoke(JUnitCoreProvider.java:119)</p>
<p>        ... 9 more<br />
Results :</p>
<p>Tests run: 0, Failures: 0, Errors: 0, Skipped: 0<br />
[/plain]</p>
<p>These are probably caused by having conflicting (and old) versions of JUnit in your dependencies. To resolve these issues, start with the dependency tree</p>
<p>[plain language="text" highlight="7,8"]<br />
$ mvn dependency:tree<br />
[INFO] --- maven-dependency-plugin:2.1:tree (default-cli) @ junit-categories ---<br />
[INFO] com.craigpardey:junit-categories:jar:1.0-SNAPSHOT<br />
[INFO] +- org.jmock:jmock-junit4:jar:2.6.0-RC2:test<br />
[INFO] |  +- org.jmock:jmock:jar:2.6.0-RC2:test<br />
[INFO] |  |  \- org.hamcrest:hamcrest-library:jar:1.3.RC2:test<br />
[INFO] |  \- junit:junit-dep:jar:4.4:test<br />
[INFO] \- junit:junit:jar:4.10:test<br />
[INFO]    \- org.hamcrest:hamcrest-core:jar:1.1:test<br />
[/plain]</p>
<p>See how jmock-junit4 depends on junit-dep:4.4, <i>and</i> that it appears <i>before</i> JUnit 4.10?  That's the cause of the error above.  You can either exclude each of these conflicting dependencies or you can make sure that the versions of JUnit and/or JUnit-dep appear first in the classpath.  The latter is achieved by putting them at the top of the dependency list in your pom.xml (or better yet, the parent pom.xml if you have one).  </p>
<p>Here's the dependency tree after moving the JUnit dependency above the jMock dependency in my pom.xml</p>
<p>[plain language="text" highlight="2,7"]<br />
[INFO] com.craigpardey:junit-categories:jar:1.0-SNAPSHOT<br />
[INFO] +- junit:junit:jar:4.10:test<br />
[INFO] |  \- org.hamcrest:hamcrest-core:jar:1.1:test<br />
[INFO] \- org.jmock:jmock-junit4:jar:2.6.0-RC2:test<br />
[INFO]    +- org.jmock:jmock:jar:2.6.0-RC2:test<br />
[INFO]    |  \- org.hamcrest:hamcrest-library:jar:1.3.RC2:test<br />
[INFO]    \- junit:junit-dep:jar:4.4:test<br />
[/plain]</p>
<p>Tests may also fail if you have all methods annotated with a category that is excluded. In this case you need to annotate the class with the exclusion category.  This is similar to how @Ignore works.</p>
